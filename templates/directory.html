{% extends "base.html" %}
{% from 'macros.html' import render_figure %}
{% from 'macros.html' import render_directory %}
{% block title %} Something from path {% endblock %}
{% block header %}
<div class='fixed' id='main-nav'>
  <nav class='top-bar' data-topbar data-options="is_hover : false">
    <ul class="title-area">
      <li class="name">
        <h1><a href="{{url_for('explicit',path='/')}}">MYfig</a></h1>
      </li>
      <!-- Collapsible Button on small screens: remove the .menu-icon class to get rid of icon. 
      Remove the "Menu" text if you only want to show the icon -->
      <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
    </ul>
    <section class="top-bar-section">
      <ul class='left'>
        <li><a href="#" data-reveal-id='file-upload'>Add Figure</a></li>
        <!--<li class="has-dropdown">
          <a href="#" data-dropdown='file-upload'>Add Figure</a>
        </li>-->
      </ul>
      <ul class="right">
        <li class="has-dropdown">
          <a href="#" class='disabled'>Sort by | Date</a>
          <ul class="dropdown" id='sort-options'>
            <li><a href="#">Date</a></li>
            <li><a href="#">Name</a></li>
            <li><a href="#">Format</a></li>
          </ul>
        </li>
        <li id='reverse-sort'><a href="#">Descending</a></li>
      </ul>
    </section>
  </nav>
  <!-- The file upload section -->
  <div id='file-upload' data-reveal data-options="close_on_background_click:false;close_on_esc:false;" class='reveal-modal xlarge'>
    <h2>Manually upload figure</h2>
    <form action="{{ url_for('explicit',path=listing.route) }}" id='upload-form' class='dropzone'>
      <b>Figure caption:</b>
        <input type='text' name='caption' value='Uploaded from web-interface.'>
      <b>Select figure file:</b>
        <div id='dz-target' class="dz-default dz-message"><span>Drag figure file here or click to select to finish uploading figure</span></div>
      <!-- Display results -->
      <div data-alert class='alert-box success' style='display:none;'>
        <b>Success!</b> Figure uploaded to server.  Reloading listings...
      </div>
    </form>
    <a class="close-reveal-modal">&times;</a>
  </div>
</div>

</div>
{% endblock %}
{% block content %}
  <div class="panel radius directories">
    <!-- Directory listing -->
    <nav class='breadcrumbs'>
      <li class='root' data-tooltip title='Root level'><a href="{{ url_for('explicit',path='/') }}">/</a></li>
      {% if crumbs|length != 0 %}
        {% if crumbs|length == 1 %}
        <li class='post-root current'><a href="{{ url_for('explicit',path=crumbs[0][1]) }}">{{ crumbs[0][0] }}</a></li>
        {% else %}
          <li class='post-root'><a href="{{ url_for('explicit',path=crumbs[0][1]) }}">{{ crumbs[0][0] }}</a></li>
          {% for crumb in crumbs[1:-1] %}
            <li><a href="{{ url_for('explicit',path=crumb[1]) }}">{{ crumb[0] }}</a></li>
          {% endfor %}
          <li class='current'><a href="{{ url_for('explicit',path=crumbs[-1][1]) }}">{{ crumbs[-1][0] }}</a></li>
        {% endif %}
      {% endif %}
    </nav>
    <hr>
    <table class='directories'>
      <thead>
        <tr>
          <th>Name</th>
          <th># Figures</th>
          <th>Last modified</th>
        </tr>
      </thead>
      <tbody>
        {% if request.path != "/" %}
          <tr>
            <th><a href="..">..</a></th>
            <th> -- </th>
            <th> -- </th>
          </tr>
        {% endif %}
        {% for dir in listing.dirs | sort(attribute='cdate',reverse=True) %}
          {{ render_directory(dir) }}
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Figures in this directory -->
  <div id='figures'>
    <div id='sort-Date'>
      <div class='sort-order' style='display:none;'>descending</div>
      {% for fig in listing.figures | sort(attribute='cdate',reverse=True) %}
        {{ render_figure(fig) }}
      {% endfor %}
    </div>
    <div id='sort-Name' style='display:none;'>
      <div class='sort-order' style='display:none;'>descending</div>
      {% for fig in listing.figures | sort(attribute='name',reverse=False) %}
        {{ render_figure(fig) }}
      {% endfor %}
    </div>
    <div id='sort-Format' style='display:none;'>
      <div class='sort-order' style='display:none;'>descending</div>
      {% for fig in listing.figures | sort(attribute='ftype',reverse=False) %}
        {{ render_figure(fig) }}
      {% endfor %}
    </div>
  </div>
{% endblock %}
